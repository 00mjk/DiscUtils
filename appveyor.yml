build_script:
- ps: >-
    $version = (Get-Content .\Library\DiscUtils.Core\project.json | ConvertFrom-Json).version

    Update-AppveyorBuild -Version "$version build $env:APPVEYOR_BUILD_NUMBER"
- ps: >-
    # Core

    dotnet restore
- ps: >-
    # Library

    dotnet pack -c Release -o Nuget\ Library\DiscUtils

    dotnet pack -c Release -o Nuget\ Library\DiscUtils.BootConfig

    dotnet pack -c Release -o Nuget\ Library\DiscUtils.Core

    dotnet pack -c Release -o Nuget\ Library\DiscUtils.Containers

    dotnet pack -c Release -o Nuget\ Library\DiscUtils.Dmg

    dotnet pack -c Release -o Nuget\ Library\DiscUtils.Ext

    dotnet pack -c Release -o Nuget\ Library\DiscUtils.Fat

    dotnet pack -c Release -o Nuget\ Library\DiscUtils.FileSystems

    dotnet pack -c Release -o Nuget\ Library\DiscUtils.HfsPlus

    dotnet pack -c Release -o Nuget\ Library\DiscUtils.Iscsi

    dotnet pack -c Release -o Nuget\ Library\DiscUtils.Iso9660

    dotnet pack -c Release -o Nuget\ Library\DiscUtils.Net

    dotnet pack -c Release -o Nuget\ Library\DiscUtils.Nfs

    dotnet pack -c Release -o Nuget\ Library\DiscUtils.Ntfs

    dotnet pack -c Release -o Nuget\ Library\DiscUtils.OpticalDiscSharing

    dotnet pack -c Release -o Nuget\ Library\DiscUtils.OpticalDisk

    dotnet pack -c Release -o Nuget\ Library\DiscUtils.Registry

    dotnet pack -c Release -o Nuget\ Library\DiscUtils.Sdi

    dotnet pack -c Release -o Nuget\ Library\DiscUtils.SquashFs

    dotnet pack -c Release -o Nuget\ Library\DiscUtils.Transports

    dotnet pack -c Release -o Nuget\ Library\DiscUtils.Udf

    dotnet pack -c Release -o Nuget\ Library\DiscUtils.Vdi

    dotnet pack -c Release -o Nuget\ Library\DiscUtils.Vhd

    dotnet pack -c Release -o Nuget\ Library\DiscUtils.Vhdx

    dotnet pack -c Release -o Nuget\ Library\DiscUtils.Vmdk

    dotnet pack -c Release -o Nuget\ Library\DiscUtils.Wim

    dotnet pack -c Release -o Nuget\ Library\DiscUtils.Xva
- ps: >-
    # Utilities

    dotnet build -c Release Utilities\BCDDump

    dotnet build -c Release Utilities\DiscUtils.Common

    dotnet build -c Release Utilities\DiscUtils.Diagnostics

    dotnet build -c Release Utilities\DiscUtils.PowerShell

    dotnet build -c Release Utilities\DiskClone

    dotnet build -c Release Utilities\DiskDump

    dotnet build -c Release Utilities\DmgExtract

    dotnet build -c Release Utilities\ExternalFileSystem

    dotnet build -c Release Utilities\FileExtract

    dotnet build -c Release Utilities\FileRecover

    dotnet build -c Release Utilities\iSCSIBrowse

    dotnet build -c Release Utilities\ISOCreate

    dotnet build -c Release Utilities\MSBuildTask

    dotnet build -c Release Utilities\NTFSDump

    dotnet build -c Release Utilities\ODSBrowse

    dotnet build -c Release Utilities\OSClone

    dotnet build -c Release Utilities\VHDCreate

    dotnet build -c Release Utilities\VHDDump

    dotnet build -c Release Utilities\VHDXDump

    dotnet build -c Release Utilities\VirtualDiskConvert

    dotnet build -c Release Utilities\VolInfo
- ps: >-
    # Tests

    dotnet build -c Release Tests\LibraryTests
test_script:
- cmd: dotnet test -c Release Tests\LibraryTests
artifacts:
- path: Nuget\*.nupkg
deploy:
- provider: NuGet
  api_key:
    secure: dgfUEGXULcqCTyNcS6UEDK8BCBi8y+M2+d4IFjnb3Gf9DqV34fMSp1XjxJg2AVRC
  on:
    branch: nuget